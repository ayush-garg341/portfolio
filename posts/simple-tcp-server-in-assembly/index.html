<!doctype html><html data-enable-theme-switch="true" data-use-system-theme="false" data-default-theme="dark" data-current="post" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Simple TCP server in assembly</title><meta name="description" content="Talks about how a simple TCP server can be built in assembly."><link rel="dns-prefetch" href="https://identity.netlify.com"><script async src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="/portfolio/assets/css/main.css"><script>// Initialize theme
    // Must run before page rendering to prevent flash
    const themeConfig = document.documentElement.dataset;
    const theme = localStorage.getItem('theme');

    if (theme) {
      themeConfig.theme = theme;
    } else {
      const defaultTheme = themeConfig.defaultTheme;
      const useSystemTheme = themeConfig.useSystemTheme === 'true';
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

      themeConfig.theme = (useSystemTheme && prefersDark) ? 'dark' : defaultTheme;
    }</script><script defer="defer" src="/portfolio/assets/js/main.bundle.js"></script></head><body><div class="wrapper-bg-wrapper"><div class="wrapper-bg"></div></div><header class="site-header"><div class="site-header__container"><span class="site-header__logo-container"><a class="site-header__logo" href="/portfolio/" aria-label="Logo"> <?xml version="1.0" encoding="utf-8"?> <svg width="40px" height="40px" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--noto" preserveAspectRatio="xMidYMid meet"><path d="M71.59 68.58H58.75c0 20.36-4.21 28.52-4.21 28.52H75.8c0-.01-4.21-8.17-4.21-28.52z" fill="#b7d5e5"></path><path d="M39.41 98.17c-.07-1.14.1-2.64.1-2.64s45.24-1.88 48.83-.09c0 0 .48 1.66.15 2.74c-.79 2.53-10.99 4.8-24.55 4.8s-24.37-2.16-24.53-4.81z" fill="#2f7889"></path><ellipse cx="64" cy="95.96" rx="24.55" ry="4.8" fill="#b7d5e5"></ellipse><path d="M71.59 68.58H58.75c0 6.64-.45 11.98-1.05 16.16l15.31 2.3c-.78-4.47-1.42-10.54-1.42-18.46z" fill="#69a1ba"></path><path d="M55.49 91.46s-3.72 1.52-2.88 2.63c1.3 1.74 4.93 2.83 13.71 3.42c6.17.41 3.75 2.13-2.05 2.48c-4.07.24-23.58.4-24.74-3.67c-.94-3.31 13.18-4.86 15.96-4.86z" fill="#eee"></path><path d="M99.4 106.51H28.49c-.97 0-1.94.54-2.48 1.4l-7.78 10.7c-.72.98-.01 2.36 1.2 2.36h89.13c1.22 0 1.92-1.38 1.2-2.36l-7.88-10.8c-.53-.76-1.5-1.3-2.48-1.3z" fill="#eee"></path><g opacity=".57" fill="#69a1ba"><path d="M35.61 111.26h-4.86l.65-1.18h4.86z"></path><path d="M43.28 111.26h-4.86l.54-1.18h5.07z"></path><path d="M50.62 111.26h-4.97l.76-1.18h4.85z"></path><path d="M57.85 111.26h-4.86l.76-1.18h4.64z"></path><path d="M65.08 111.26h-4.97l.44-1.18h4.1z"></path><path d="M72.31 111.26h-4.86l-.54-1.18h4.65z"></path><path d="M79.87 111.26H74.9l-.86-1.18h4.86z"></path><path d="M87.1 111.26h-4.97l-.86-1.18h4.97z"></path><path d="M96.92 111.26h-7.45l-.86-1.18h7.56z"></path><path d="M93.14 113.21H98l-.86-1.3h-4.97z"></path><path d="M85.16 113.21h4.85l-.97-1.3h-4.86z"></path><path d="M77.82 113.21h4.85l-.75-1.3h-4.97z"></path><path d="M69.94 113.21h4.85l-.86-1.3h-4.64z"></path><path d="M62.92 113.21h4.86l-.54-1.3h-4.1z"></path><path d="M55.9 113.21h4.86l.33-1.3h-4.75z"></path><path d="M48.24 113.21h4.86l.65-1.3H49z"></path><path d="M39.61 113.21h4.96l.76-1.3h-4.97z"></path><path d="M29.68 113.21h7.34l.75-1.3h-7.45z"></path><path d="M76.09 115.15h4.96l-.86-1.3h-4.96z"></path><path d="M68.32 115.15h4.85l-.64-1.3h-4.64z"></path><path d="M59.03 115.15H64l-.11-1.3h-4.42z"></path><path d="M50.29 115.15h4.97l.43-1.3h-4.75z"></path><path d="M41.12 115.15h4.85l.76-1.3h-4.86z"></path><path d="M28.7 115.15h9.83l.75-1.3h-9.82z"></path><path d="M84.4 115.15h14.68l-.86-1.3H83.54z"></path><path d="M95.52 117.09h4.96l-.97-1.29h-4.96z"></path><path d="M86.45 117.09h4.86l-.97-1.29h-4.86z"></path><path d="M47.27 117.09h33.35l-.75-1.29H48.02z"></path><path d="M36.8 117.09h4.96l.54-1.29h-4.75z"></path><path d="M27.52 117.09h4.85l.54-1.29h-4.75z"></path></g><path d="M108.69 124H19.31c-.88 0-1.64-.76-1.64-1.62v-2.4h92.68v2.4c-.01.86-.78 1.62-1.66 1.62z" fill="#2f7889"></path><path d="M99.4 107.52c.61 0 1.3.36 1.67.88l8.22 11.27c.05.06.05.13.02.2c-.04.07-.09.1-.17.1H18.86c-.08 0-.13-.03-.17-.1a.166.166 0 0 1 .02-.2l8.12-11.16l.02-.03l.02-.03c.35-.57.99-.93 1.63-.93h70.9m0-1.01H28.49c-.97 0-1.94.54-2.48 1.4l-8.12 11.16c-.57.79-.01 1.9.97 1.9h90.29c.98 0 1.54-1.11.97-1.9l-8.22-11.27c-.55-.75-1.52-1.29-2.5-1.29z" fill="#b7d5e5"></path><path d="M113.46 79.66H14.54a3.44 3.44 0 0 1-3.44-3.44v-67c0-1.9 1.54-3.44 3.44-3.44h98.91c1.9 0 3.44 1.54 3.44 3.44v67c.01 1.9-1.53 3.44-3.43 3.44z" fill="#69a1ba"></path><path d="M113.46 77.89H14.54a3.44 3.44 0 0 1-3.44-3.44v-67c0-1.9 1.54-3.44 3.44-3.44h98.91c1.9 0 3.44 1.54 3.44 3.44v67a3.431 3.431 0 0 1-3.43 3.44z" fill="#b7d5e5"></path><radialGradient id="IconifyId17ecdb2904d178eab7646" cx="46.465" cy="-5.176" r="60.973" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2f7889"></stop><stop offset="1" stop-color="#424242"></stop></radialGradient><path fill="url(#IconifyId17ecdb2904d178eab7646)" d="M15.25 9.38h97.5V72.5h-97.5z"></path><path fill="none" stroke="#eee" stroke-width="3.014" stroke-linecap="round" stroke-miterlimit="10" d="M16.39 6.99h11.19"></path></svg> </a></span><button class="site-header__mobile-nav" data-drawer-trigger="" aria-controls="drawer-name" aria-expanded="false"><span class="site-header__mobile-nav-label">Menu</span> <svg width="226" height="187" viewBox="0 0 226 187" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 0H225.311V22.8494H0V0Z" fill="currentColor"/><path d="M0 81.872H225.311V104.721H0V81.872Z" fill="currentColor"/><path d="M0 163.744H225.311V186.593H0V163.744Z" fill="currentColor"/></svg></button><nav class="site-header__nav"><ul class="site-header__items"><li class="site-header__item"><a class="site-header__link" href="/portfolio/about/">About</a></li><li class="site-header__item"><a class="site-header__link" href="/portfolio/blog/">Blog</a></li><li class="site-header__item"><a class="site-header__link" href="/portfolio/projects/">Projects</a></li><li class="site-header__item"><a class="site-header__link" href="/portfolio/contact/">Contact</a></li><li class="site-header__item"><button class="site-header__link site-header__link--theme-switch" data-theme-switch><svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 14C7.01472 14 5 11.9853 5 9.5C5 7.01472 7.01472 5 9.5 5C11.9853 5 14 7.01472 14 9.5C14 11.9853 11.9853 14 9.5 14ZM9.5 13C11.433 13 13 11.433 13 9.5C13 7.567 11.433 6 9.5 6C7.567 6 6 7.567 6 9.5C6 11.433 7.567 13 9.5 13ZM10 3H9V0H10V3ZM14.4497 5.25736L13.7426 4.55025L15.864 2.42893L16.5711 3.13604L14.4497 5.25736ZM16 10V9H19V10H16ZM13.7426 14.4497L14.4497 13.7426L16.5711 15.864L15.864 16.5711L13.7426 14.4497ZM9 16H10V19H9V16ZM4.55025 13.7426L5.25736 14.4497L3.13604 16.5711L2.42893 15.864L4.55025 13.7426ZM3 9V10H0V9H3ZM5.25736 4.55025L4.55025 5.25736L2.42893 3.13604L3.13604 2.42893L5.25736 4.55025Z" fill="currentColor"/></svg></button></li></ul></nav></div></header><section class="drawer" id="drawer-name" data-drawer-target><div class="drawer__overlay" data-drawer-close tabindex="-1"></div><div class="drawer__wrapper"><div class="drawer__header"><button class="drawer__close" data-drawer-close aria-label="Close Drawer"><svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.84294L3.84294 0L22.4996 18.7131L41.2127 0L45 3.84294L26.3425 22.4996L45 41.2127L41.2127 45L22.4996 26.3425L3.84294 45L0 41.2127L18.7131 22.4996L0 3.84294Z" fill="currentColor"/></svg></button></div><div class="drawer__content"><ul class="drawer__nav"><li class="drawer__nav-item"><a href="/">Home</a></li><li class="drawer__nav-item"><a href="/portfolio/about/">About</a></li><li class="drawer__nav-item"><a href="/portfolio/blog/">Blog</a></li><li class="drawer__nav-item"><a href="/portfolio/projects/">Projects</a></li><li class="drawer__nav-item"><a href="/portfolio/contact/">Contact</a></li></ul></div></div></section><main><div class="page-container"><article><h1>Simple TCP server in assembly</h1><p><time datetime="2026-02-09">9 February 2026</time></p><hr><ul><li>Do you need to know assembly? No</li><li>Will you need it in your day 2 day life as software engineer? No</li><li>Then, why learn assembly?<ul><li>To write very high performant and low memory footprint code. Sometimes situation is too critical.</li><li>During your system boot-up, no C, Java, C++ gets loaded, but only assembly which directly runs on CPU and load BIOS and other critical things from disk.</li><li>Read more on this reddit thread <a href="https://www.reddit.com/r/asm/comments/p5d9tf/why_should_i_learn_assembly/">here</a>.</li></ul></li></ul><p>So today w'll be talking about web server in assembly. So, how do we interact with the outside world? Like emitting radio waves, receiving waves etc etc…</p><ul><li>There is no single instruction in x86_64 assembly which allows to do so otherwise it will be a big security mess.</li><li>Instead we can ask the kernel, hey I want to connect to the outside world. Check my permissions and other things, I am a legit user not a bad one.</li><li>So to ask kernel, we need to use <strong>syscalls</strong> which will help us to connect to the outside world.</li><li>Now these syscalls each have a specific number associated with them which is loaded into the register (rax) and then instruction <strong>syscall</strong>.</li></ul><p>Now first let's understand the assembly registers in details.</p><ul><li>Assembly instructions operate on registers, small pieces of very fast memory inside the processor. To process data stored in memory, the processor first needs to load it into registers; and once it has completed working on the data in a register, it needs to store it back to memory.</li><li>First we will look what are the available registers and common instructions before getting into details of TCP server.</li></ul><p><picture><source type="image/webp" srcset="/portfolio/assets/img/6MsM5ub96T-250.webp 250w, /portfolio/assets/img/6MsM5ub96T-316.webp 316w, /portfolio/assets/img/6MsM5ub96T-426.webp 426w, /portfolio/assets/img/6MsM5ub96T-460.webp 460w, /portfolio/assets/img/6MsM5ub96T-500.webp 500w, /portfolio/assets/img/6MsM5ub96T-580.webp 580w, /portfolio/assets/img/6MsM5ub96T-632.webp 632w, /portfolio/assets/img/6MsM5ub96T-768.webp 768w, /portfolio/assets/img/6MsM5ub96T-852.webp 852w, /portfolio/assets/img/6MsM5ub96T-920.webp 920w, /portfolio/assets/img/6MsM5ub96T-1160.webp 1160w" sizes="(max-width: 768px) 100vw, 768px"><source type="image/jpeg" srcset="/portfolio/assets/img/6MsM5ub96T-250.jpeg 250w, /portfolio/assets/img/6MsM5ub96T-316.jpeg 316w, /portfolio/assets/img/6MsM5ub96T-426.jpeg 426w, /portfolio/assets/img/6MsM5ub96T-460.jpeg 460w, /portfolio/assets/img/6MsM5ub96T-500.jpeg 500w, /portfolio/assets/img/6MsM5ub96T-580.jpeg 580w, /portfolio/assets/img/6MsM5ub96T-632.jpeg 632w, /portfolio/assets/img/6MsM5ub96T-768.jpeg 768w, /portfolio/assets/img/6MsM5ub96T-852.jpeg 852w, /portfolio/assets/img/6MsM5ub96T-920.jpeg 920w, /portfolio/assets/img/6MsM5ub96T-1160.jpeg 1160w" sizes="(max-width: 768px) 100vw, 768px"><img alt="Registers" loading="lazy" decoding="async" src="/portfolio/assets/img/6MsM5ub96T-250.jpeg" width="1160" height="855"></picture></p><p><strong>Caller (the function which is calling another function) saved registers (volatile registers):</strong></p><ul><li>The caller must save these before calling a function - if it needs them preserved.</li><li>These registers may be destroyed by the function you call.</li><li><strong>rdi, rsi, rdx, rcx, rax, r8, r9, r10, r11.</strong></li><li>These are also used for syscall and function arguments.</li><li>If you call a function, assume these registers will change.</li></ul><p><strong>Callee (function which is being called) saved registers (non-volatile registers):</strong></p><ul><li>The callee must restore these to their original value before returning.</li><li><strong>rbx, rbp, r12, r13, r14, r15</strong></li><li>If your function uses any of these registers, you MUST:</li><li>The caller expects these registers to stay unchanged.</li></ul><pre class="language-nasm"><code class="language-nasm">push <span class="token register variable">r12</span><br>…. <br>pop <span class="token register variable">r12</span><br>ret</code></pre><p>Common instruction set in x86-64 assembly. These instructions are self explanatory and for more details on them, google them once.</p><p><picture><source type="image/webp" srcset="/portfolio/assets/img/8qiTbukO36-250.webp 250w, /portfolio/assets/img/8qiTbukO36-316.webp 316w, /portfolio/assets/img/8qiTbukO36-426.webp 426w, /portfolio/assets/img/8qiTbukO36-460.webp 460w, /portfolio/assets/img/8qiTbukO36-500.webp 500w, /portfolio/assets/img/8qiTbukO36-580.webp 580w, /portfolio/assets/img/8qiTbukO36-632.webp 632w, /portfolio/assets/img/8qiTbukO36-768.webp 768w, /portfolio/assets/img/8qiTbukO36-852.webp 852w, /portfolio/assets/img/8qiTbukO36-920.webp 920w" sizes="(max-width: 768px) 100vw, 768px"><source type="image/jpeg" srcset="/portfolio/assets/img/8qiTbukO36-250.jpeg 250w, /portfolio/assets/img/8qiTbukO36-316.jpeg 316w, /portfolio/assets/img/8qiTbukO36-426.jpeg 426w, /portfolio/assets/img/8qiTbukO36-460.jpeg 460w, /portfolio/assets/img/8qiTbukO36-500.jpeg 500w, /portfolio/assets/img/8qiTbukO36-580.jpeg 580w, /portfolio/assets/img/8qiTbukO36-632.jpeg 632w, /portfolio/assets/img/8qiTbukO36-768.jpeg 768w, /portfolio/assets/img/8qiTbukO36-852.jpeg 852w, /portfolio/assets/img/8qiTbukO36-920.jpeg 920w" sizes="(max-width: 768px) 100vw, 768px"><img alt="Instructions" loading="lazy" decoding="async" src="/portfolio/assets/img/8qiTbukO36-250.jpeg" width="920" height="1160"></picture></p><h4 id="tcp-server" tabindex="-1"><a class="header-anchor" href="#tcp-server">#</a> TCP server</h4><ul><li>Let's break down TCP server functionality and features.</li><li>So when we develop the TCP server in high level language, we do:<ul><li>Open the socket</li><li>Bind</li><li>Listen</li><li>Now in the for loop:</li><li>Accept the incoming connection ( parent process will accept the connection )</li><li>Fork the process.</li><li>Now child will do all heavy lifting to process the request and parent will keep accepting the request.</li><li>Child will check whether it's GET or POST and then will act accordingly.</li><li>rax register is responsible for holding return values and syscall numbers.</li></ul></li></ul><ol><li>So opening the socket, binding the address and listening.</li></ol><pre class="language-nasm"><code class="language-nasm"><br>.intel_syntax noprefix<br>.globl _start<br><br>.section .text<br><br><span class="token label function">_start:</span><br>        # open the socket <br>        mov <span class="token register variable">rdi</span>, <span class="token number">2</span><br>        mov <span class="token register variable">rsi</span>, <span class="token number">1</span><br>        mov <span class="token register variable">rdx</span>, <span class="token number">0</span> <br>        mov <span class="token register variable">rax</span>, <span class="token number">41</span> # syscall number for socket in <span class="token register variable">rax</span><br>        syscall<br><br>        mov <span class="token register variable">r12</span>, <span class="token register variable">rax</span><br><br>        # bind<br>        mov <span class="token register variable">rax</span>, <span class="token number">49</span><br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, offset sockaddr_in<br>        mov <span class="token register variable">rdx</span>, <span class="token number">16</span><br>        syscall<br><br>        # listen <br>        mov <span class="token register variable">rax</span>, <span class="token number">50</span><br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, <span class="token number">0</span><br>        syscall <br><br>        mov <span class="token register variable">r13</span>, <span class="token register variable">r12</span><br><br>        jmp iterative_server</code></pre><ol start="2"><li>Now iterative server - accept the connection from the client, fork the process and jump to parent or child process depending on return value in rax register.</li></ol><pre class="language-nasm"><code class="language-nasm"><span class="token label function">iterative_server:</span><br><br>        # accept <br>        mov <span class="token register variable">rax</span>, <span class="token number">43</span><br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, <span class="token number">0</span><br>        mov <span class="token register variable">rdx</span>, <span class="token number">0</span><br>        syscall<br><br>        mov <span class="token register variable">r12</span>, <span class="token register variable">rax</span><br><br>        # forking<br>        mov <span class="token register variable">rax</span>, <span class="token number">57</span><br>        syscall<br><br>        cmp <span class="token register variable">rax</span>, <span class="token number">0</span><br>        je child_process<br>        jmp parent_process</code></pre><ol start="3"><li>Now the child process will process the request and based on GET or POST. In this exercise we will see only GET request.</li></ol><pre class="language-nasm"><code class="language-nasm"><span class="token label function">child_process:</span><br><br>        # close the listening socket connection<br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r13</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">3</span><br>        syscall<br><br>        # read request <br>        mov <span class="token register variable">rax</span>, <span class="token number">0</span><br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, offset buffer<br>        mov <span class="token register variable">rdx</span>, <span class="token number">1024</span><br>        syscall<br>        mov <span class="token register variable">r10</span>, <span class="token register variable">rax</span><br><br>        cmp byte ptr <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">]</span>, <span class="token string">'G'</span><br>        je process_get_request</code></pre><ol start="4"><li>Now the code for processing GET request. For now we are sending the static content, but it can be modified to send dynamic content as well.</li></ol><pre class="language-nasm"><code class="language-nasm"><span class="token label function">process_get_request:</span><br><br>        # write static response<br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, offset static_response<br>        mov <span class="token register variable">rdx</span>, <span class="token number">19</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">1</span><br>        syscall <br><br>     <br>        # close the fd <br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">3</span><br>        syscall<br><br>        jmp exit</code></pre><ol start="5"><li>Parent process</li></ol><pre class="language-nasm"><code class="language-nasm"><span class="token label function">parent_process:</span><br><br>        # close the request processing fd <br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">3</span><br>        syscall<br><br>        mov <span class="token register variable">r12</span>, <span class="token register variable">r13</span><br>        jmp iterative_server<br><br><span class="token label function">exit:</span><br>        mov <span class="token register variable">rdi</span>, <span class="token number">0</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">60</span><br>        syscall</code></pre><ol start="6"><li>Finally how we are storing our data like sock address on which we are listening and static response.</li></ol><pre class="language-nasm"><code class="language-nasm">.section .data<br><span class="token label function">sockaddr_in:</span><br>    .2byte <span class="token number">2</span><br>    .2byte <span class="token number">0x5000</span><br>    .4byte <span class="token number">0x00000000</span><br>    .8byte <span class="token number">0x0</span><br><br><span class="token label function">static_response:</span><br>    .string <span class="token string">"HTTP/1.0 200 OK\r\n\r\n"</span><br><br><br>.section .bss<br><span class="token label function">buffer:</span> <br>    .skip <span class="token number">1024</span><br><br><br><span class="token label function">request_method:</span><br>    .skip <span class="token number">5</span></code></pre><p>Difference between .data and .bss??</p><ul><li>.data holds initialized global/static data, bytes are stored inside the executable, takes space in the binary on disk, Read/write at runtime.</li><li>.bss holds uninitialized (or zero-initialized) data, not stored in the executable, loader allocates memory and fills it with zeros, exists only in RAM.</li><li>.rodata - constants (read-only), any write segmentation fault, shared between processes.</li></ul><h4 id="fork-role-in-tcp-server%3A" tabindex="-1"><a class="header-anchor" href="#fork-role-in-tcp-server%3A">#</a> FORK role in TCP server:</h4><ul><li>Let's say we had sock fd as 3, it means we were listening on 3 sock fd and accepting new client connections and getting new client fds.</li><li>So somehow if we could keep accepting connections in parent and then delegate them to child for processing, it will increase the throughput.</li><li>It means we should keep sock fd 3 open in parent, and client specific fd open in child. But when we fork we get the same fds in both parent and child and closing the fd in one does not affect the other.</li><li>So now lets' say on sock fd 3, the new client has connected with sock fd 4 and we fork now, we will get 3 and 4 in the child process. So we can close 3 ( accepting connection fd ) in child and 4 ( client specific fd ) in parent, otherwise there would be chaos of output sent to client. This way we will keep accepting connection requests in the parent process and process the requests in the child process.</li></ul><p>So here is the complete code for the simple tcp server:</p><pre class="language-nasm"><code class="language-nasm">.intel_syntax noprefix<br>.globl _start<br><br>.section .text<br><br><span class="token label function">_start:</span><br>        # open the socket <br>        mov <span class="token register variable">rdi</span>, <span class="token number">2</span><br>        mov <span class="token register variable">rsi</span>, <span class="token number">1</span><br>        mov <span class="token register variable">rdx</span>, <span class="token number">0</span> <br>        mov <span class="token register variable">rax</span>, <span class="token number">41</span><br>        syscall<br><br>        mov <span class="token register variable">r12</span>, <span class="token register variable">rax</span><br><br>        # bind<br>        mov <span class="token register variable">rax</span>, <span class="token number">49</span><br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, offset sockaddr_in<br>        mov <span class="token register variable">rdx</span>, <span class="token number">16</span><br>        syscall<br><br>        # listen <br>        mov <span class="token register variable">rax</span>, <span class="token number">50</span><br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, <span class="token number">0</span><br>        syscall <br><br>        mov <span class="token register variable">r13</span>, <span class="token register variable">r12</span><br><br>        jmp iterative_server<br><br><br><span class="token label function">iterative_server:</span><br><br>        # accept <br>        mov <span class="token register variable">rax</span>, <span class="token number">43</span><br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, <span class="token number">0</span><br>        mov <span class="token register variable">rdx</span>, <span class="token number">0</span><br>        syscall<br><br>        mov <span class="token register variable">r12</span>, <span class="token register variable">rax</span><br><br>        # forking<br>        mov <span class="token register variable">rax</span>, <span class="token number">57</span><br>        syscall<br><br>        cmp <span class="token register variable">rax</span>, <span class="token number">0</span><br>        je child_process<br>        jmp parent_process<br><br><span class="token label function">child_process:</span><br><br>        # close the listening socket connection<br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r13</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">3</span><br>        syscall<br><br>        # read request <br>        mov <span class="token register variable">rax</span>, <span class="token number">0</span><br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, offset buffer<br>        mov <span class="token register variable">rdx</span>, <span class="token number">1024</span><br>        syscall<br>        mov <span class="token register variable">r10</span>, <span class="token register variable">rax</span><br><br>        cmp byte ptr <span class="token operator">[</span><span class="token register variable">rsi</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">]</span>, <span class="token string">'G'</span><br>        je process_get_request<br><br><br><span class="token label function">process_get_request:</span><br><br>        # write static response<br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rsi</span>, offset static_response<br>        mov <span class="token register variable">rdx</span>, <span class="token number">34</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">1</span><br>        syscall <br><br>        # close the fd <br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">3</span><br>        syscall<br><br>        jmp exit<br><br><br><span class="token label function">parent_process:</span><br><br>        # close the request processing fd <br>        mov <span class="token register variable">rdi</span>, <span class="token register variable">r12</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">3</span><br>        syscall<br><br>        mov <span class="token register variable">r12</span>, <span class="token register variable">r13</span><br>        jmp iterative_server<br><br><span class="token label function">exit:</span><br>        mov <span class="token register variable">rdi</span>, <span class="token number">0</span><br>        mov <span class="token register variable">rax</span>, <span class="token number">60</span><br>        syscall<br><br>.section .data<br><span class="token label function">sockaddr_in:</span><br>    .2byte <span class="token number">2</span><br>    .2byte <span class="token number">0x901F</span><br>    .4byte <span class="token number">0x00000000</span><br>    .8byte <span class="token number">0x0</span><br><br><span class="token label function">static_response:</span><br>    .string <span class="token string">"HTTP/1.0 200 OK FROM TCP SERVER\r\n\r\n"</span><br><br><br>.section .bss<br><span class="token label function">buffer:</span> <br>    .skip <span class="token number">1024</span><br><br><span class="token label function">request_method:</span><br>    .skip <span class="token number">5</span></code></pre><ul><li>Compile the code like shown below:</li></ul><pre class="language-bash"><code class="language-bash"><br>as <span class="token parameter variable">-o</span> server.o  server.s <span class="token operator">&amp;&amp;</span> ld <span class="token parameter variable">-o</span> server server.o<br><br><span class="token comment"># run it</span><br>./server</code></pre><ul><li><p>You will see something like below:<br><picture><source type="image/webp" srcset="/portfolio/assets/img/pGJxaxWZ41-250.webp 250w, /portfolio/assets/img/pGJxaxWZ41-316.webp 316w, /portfolio/assets/img/pGJxaxWZ41-426.webp 426w, /portfolio/assets/img/pGJxaxWZ41-460.webp 460w, /portfolio/assets/img/pGJxaxWZ41-500.webp 500w, /portfolio/assets/img/pGJxaxWZ41-580.webp 580w, /portfolio/assets/img/pGJxaxWZ41-632.webp 632w, /portfolio/assets/img/pGJxaxWZ41-768.webp 768w, /portfolio/assets/img/pGJxaxWZ41-852.webp 852w, /portfolio/assets/img/pGJxaxWZ41-920.webp 920w, /portfolio/assets/img/pGJxaxWZ41-1160.webp 1160w" sizes="(max-width: 768px) 100vw, 768px"><source type="image/jpeg" srcset="/portfolio/assets/img/pGJxaxWZ41-250.jpeg 250w, /portfolio/assets/img/pGJxaxWZ41-316.jpeg 316w, /portfolio/assets/img/pGJxaxWZ41-426.jpeg 426w, /portfolio/assets/img/pGJxaxWZ41-460.jpeg 460w, /portfolio/assets/img/pGJxaxWZ41-500.jpeg 500w, /portfolio/assets/img/pGJxaxWZ41-580.jpeg 580w, /portfolio/assets/img/pGJxaxWZ41-632.jpeg 632w, /portfolio/assets/img/pGJxaxWZ41-768.jpeg 768w, /portfolio/assets/img/pGJxaxWZ41-852.jpeg 852w, /portfolio/assets/img/pGJxaxWZ41-920.jpeg 920w, /portfolio/assets/img/pGJxaxWZ41-1160.jpeg 1160w" sizes="(max-width: 768px) 100vw, 768px"><img alt="Output" loading="lazy" decoding="async" src="/portfolio/assets/img/pGJxaxWZ41-250.jpeg" width="1160" height="141"></picture></p></li><li><p>Check the complete code at <a href="https://github.com/ayush-garg341/c_codes/blob/master/assembly/simple_tcp_server.s">github</a>. For more complex code, there is another file tcp_server.s which also serves POST request. Try to read that code and understand.</p></li></ul><p>I keep sharing stuff like this, if you have any doubt or question, DM me. Follow me for more such content. Happy learning!!</p><p class="tag-list"><a class="tag" href="/portfolio/tags/assembly/" rel="tag">assembly</a> <a class="tag" href="/portfolio/tags/TCP/" rel="tag">TCP</a> <a class="tag" href="/portfolio/tags/server/" rel="tag">server</a> <a class="tag" href="/portfolio/tags/registers/" rel="tag">registers</a></p></article><nav><a href="/portfolio/blog/">← View All Articles</a></nav></div></main><footer class="site-footer"><medium>Connect with me on <a href="https://x.com/bbetterengineer" target="_blank">X</a>, <a href="https://github.com/ayush-garg341" target="_blank">GitHub</a> or <a href="https://www.linkedin.com/in/ayush-garg-5bb04114b/" target="_blank">Linkedin</a>.</medium></footer></body></html>