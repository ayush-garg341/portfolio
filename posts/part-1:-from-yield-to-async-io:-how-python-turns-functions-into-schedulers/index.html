<!doctype html><html data-enable-theme-switch="true" data-use-system-theme="false" data-default-theme="dark" data-current="post" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Part 1: From yield to Async IO: How Python Turns Functions Into Schedulers</title><meta name="description" content="How yield turns into async programming via cooperative scheduling."><link rel="dns-prefetch" href="https://identity.netlify.com"><script async src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="/portfolio/assets/css/main.css"><script>// Initialize theme
    // Must run before page rendering to prevent flash
    const themeConfig = document.documentElement.dataset;
    const theme = localStorage.getItem('theme');

    if (theme) {
      themeConfig.theme = theme;
    } else {
      const defaultTheme = themeConfig.defaultTheme;
      const useSystemTheme = themeConfig.useSystemTheme === 'true';
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

      themeConfig.theme = (useSystemTheme && prefersDark) ? 'dark' : defaultTheme;
    }</script><script defer="defer" src="/portfolio/assets/js/main.bundle.js"></script></head><body><div class="wrapper-bg-wrapper"><div class="wrapper-bg"></div></div><header class="site-header"><div class="site-header__container"><span class="site-header__logo-container"><a class="site-header__logo" href="/portfolio/" aria-label="Logo"> <?xml version="1.0" encoding="utf-8"?> <svg width="40px" height="40px" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--noto" preserveAspectRatio="xMidYMid meet"><path d="M71.59 68.58H58.75c0 20.36-4.21 28.52-4.21 28.52H75.8c0-.01-4.21-8.17-4.21-28.52z" fill="#b7d5e5"></path><path d="M39.41 98.17c-.07-1.14.1-2.64.1-2.64s45.24-1.88 48.83-.09c0 0 .48 1.66.15 2.74c-.79 2.53-10.99 4.8-24.55 4.8s-24.37-2.16-24.53-4.81z" fill="#2f7889"></path><ellipse cx="64" cy="95.96" rx="24.55" ry="4.8" fill="#b7d5e5"></ellipse><path d="M71.59 68.58H58.75c0 6.64-.45 11.98-1.05 16.16l15.31 2.3c-.78-4.47-1.42-10.54-1.42-18.46z" fill="#69a1ba"></path><path d="M55.49 91.46s-3.72 1.52-2.88 2.63c1.3 1.74 4.93 2.83 13.71 3.42c6.17.41 3.75 2.13-2.05 2.48c-4.07.24-23.58.4-24.74-3.67c-.94-3.31 13.18-4.86 15.96-4.86z" fill="#eee"></path><path d="M99.4 106.51H28.49c-.97 0-1.94.54-2.48 1.4l-7.78 10.7c-.72.98-.01 2.36 1.2 2.36h89.13c1.22 0 1.92-1.38 1.2-2.36l-7.88-10.8c-.53-.76-1.5-1.3-2.48-1.3z" fill="#eee"></path><g opacity=".57" fill="#69a1ba"><path d="M35.61 111.26h-4.86l.65-1.18h4.86z"></path><path d="M43.28 111.26h-4.86l.54-1.18h5.07z"></path><path d="M50.62 111.26h-4.97l.76-1.18h4.85z"></path><path d="M57.85 111.26h-4.86l.76-1.18h4.64z"></path><path d="M65.08 111.26h-4.97l.44-1.18h4.1z"></path><path d="M72.31 111.26h-4.86l-.54-1.18h4.65z"></path><path d="M79.87 111.26H74.9l-.86-1.18h4.86z"></path><path d="M87.1 111.26h-4.97l-.86-1.18h4.97z"></path><path d="M96.92 111.26h-7.45l-.86-1.18h7.56z"></path><path d="M93.14 113.21H98l-.86-1.3h-4.97z"></path><path d="M85.16 113.21h4.85l-.97-1.3h-4.86z"></path><path d="M77.82 113.21h4.85l-.75-1.3h-4.97z"></path><path d="M69.94 113.21h4.85l-.86-1.3h-4.64z"></path><path d="M62.92 113.21h4.86l-.54-1.3h-4.1z"></path><path d="M55.9 113.21h4.86l.33-1.3h-4.75z"></path><path d="M48.24 113.21h4.86l.65-1.3H49z"></path><path d="M39.61 113.21h4.96l.76-1.3h-4.97z"></path><path d="M29.68 113.21h7.34l.75-1.3h-7.45z"></path><path d="M76.09 115.15h4.96l-.86-1.3h-4.96z"></path><path d="M68.32 115.15h4.85l-.64-1.3h-4.64z"></path><path d="M59.03 115.15H64l-.11-1.3h-4.42z"></path><path d="M50.29 115.15h4.97l.43-1.3h-4.75z"></path><path d="M41.12 115.15h4.85l.76-1.3h-4.86z"></path><path d="M28.7 115.15h9.83l.75-1.3h-9.82z"></path><path d="M84.4 115.15h14.68l-.86-1.3H83.54z"></path><path d="M95.52 117.09h4.96l-.97-1.29h-4.96z"></path><path d="M86.45 117.09h4.86l-.97-1.29h-4.86z"></path><path d="M47.27 117.09h33.35l-.75-1.29H48.02z"></path><path d="M36.8 117.09h4.96l.54-1.29h-4.75z"></path><path d="M27.52 117.09h4.85l.54-1.29h-4.75z"></path></g><path d="M108.69 124H19.31c-.88 0-1.64-.76-1.64-1.62v-2.4h92.68v2.4c-.01.86-.78 1.62-1.66 1.62z" fill="#2f7889"></path><path d="M99.4 107.52c.61 0 1.3.36 1.67.88l8.22 11.27c.05.06.05.13.02.2c-.04.07-.09.1-.17.1H18.86c-.08 0-.13-.03-.17-.1a.166.166 0 0 1 .02-.2l8.12-11.16l.02-.03l.02-.03c.35-.57.99-.93 1.63-.93h70.9m0-1.01H28.49c-.97 0-1.94.54-2.48 1.4l-8.12 11.16c-.57.79-.01 1.9.97 1.9h90.29c.98 0 1.54-1.11.97-1.9l-8.22-11.27c-.55-.75-1.52-1.29-2.5-1.29z" fill="#b7d5e5"></path><path d="M113.46 79.66H14.54a3.44 3.44 0 0 1-3.44-3.44v-67c0-1.9 1.54-3.44 3.44-3.44h98.91c1.9 0 3.44 1.54 3.44 3.44v67c.01 1.9-1.53 3.44-3.43 3.44z" fill="#69a1ba"></path><path d="M113.46 77.89H14.54a3.44 3.44 0 0 1-3.44-3.44v-67c0-1.9 1.54-3.44 3.44-3.44h98.91c1.9 0 3.44 1.54 3.44 3.44v67a3.431 3.431 0 0 1-3.43 3.44z" fill="#b7d5e5"></path><radialGradient id="IconifyId17ecdb2904d178eab7646" cx="46.465" cy="-5.176" r="60.973" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2f7889"></stop><stop offset="1" stop-color="#424242"></stop></radialGradient><path fill="url(#IconifyId17ecdb2904d178eab7646)" d="M15.25 9.38h97.5V72.5h-97.5z"></path><path fill="none" stroke="#eee" stroke-width="3.014" stroke-linecap="round" stroke-miterlimit="10" d="M16.39 6.99h11.19"></path></svg> </a></span><button class="site-header__mobile-nav" data-drawer-trigger="" aria-controls="drawer-name" aria-expanded="false"><span class="site-header__mobile-nav-label">Menu</span> <svg width="226" height="187" viewBox="0 0 226 187" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 0H225.311V22.8494H0V0Z" fill="currentColor"/><path d="M0 81.872H225.311V104.721H0V81.872Z" fill="currentColor"/><path d="M0 163.744H225.311V186.593H0V163.744Z" fill="currentColor"/></svg></button><nav class="site-header__nav"><ul class="site-header__items"><li class="site-header__item"><a class="site-header__link" href="/portfolio/about/">About</a></li><li class="site-header__item"><a class="site-header__link" href="/portfolio/blog/">Blog</a></li><li class="site-header__item"><a class="site-header__link" href="/portfolio/projects/">Projects</a></li><li class="site-header__item"><a class="site-header__link" href="/portfolio/contact/">Contact</a></li><li class="site-header__item"><button class="site-header__link site-header__link--theme-switch" data-theme-switch><svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 14C7.01472 14 5 11.9853 5 9.5C5 7.01472 7.01472 5 9.5 5C11.9853 5 14 7.01472 14 9.5C14 11.9853 11.9853 14 9.5 14ZM9.5 13C11.433 13 13 11.433 13 9.5C13 7.567 11.433 6 9.5 6C7.567 6 6 7.567 6 9.5C6 11.433 7.567 13 9.5 13ZM10 3H9V0H10V3ZM14.4497 5.25736L13.7426 4.55025L15.864 2.42893L16.5711 3.13604L14.4497 5.25736ZM16 10V9H19V10H16ZM13.7426 14.4497L14.4497 13.7426L16.5711 15.864L15.864 16.5711L13.7426 14.4497ZM9 16H10V19H9V16ZM4.55025 13.7426L5.25736 14.4497L3.13604 16.5711L2.42893 15.864L4.55025 13.7426ZM3 9V10H0V9H3ZM5.25736 4.55025L4.55025 5.25736L2.42893 3.13604L3.13604 2.42893L5.25736 4.55025Z" fill="currentColor"/></svg></button></li></ul></nav></div></header><section class="drawer" id="drawer-name" data-drawer-target><div class="drawer__overlay" data-drawer-close tabindex="-1"></div><div class="drawer__wrapper"><div class="drawer__header"><button class="drawer__close" data-drawer-close aria-label="Close Drawer"><svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.84294L3.84294 0L22.4996 18.7131L41.2127 0L45 3.84294L26.3425 22.4996L45 41.2127L41.2127 45L22.4996 26.3425L3.84294 45L0 41.2127L18.7131 22.4996L0 3.84294Z" fill="currentColor"/></svg></button></div><div class="drawer__content"><ul class="drawer__nav"><li class="drawer__nav-item"><a href="/">Home</a></li><li class="drawer__nav-item"><a href="/portfolio/about/">About</a></li><li class="drawer__nav-item"><a href="/portfolio/blog/">Blog</a></li><li class="drawer__nav-item"><a href="/portfolio/projects/">Projects</a></li><li class="drawer__nav-item"><a href="/portfolio/contact/">Contact</a></li></ul></div></div></section><main><div class="page-container"><article><h1>Part 1: From yield to Async IO: How Python Turns Functions Into Schedulers</h1><p><time datetime="2026-02-17">17 February 2026</time></p><hr><p>We write multi-threaded programs to make better use of modern hardware and multi-process programs to distribute work across machines. Purpose of both is to enhance the performance at the expense of simplicity. With co-routines the programs thought process is more naturally expressed as a series of cooperative processes.</p><p><strong>Coroutines Python2:</strong></p><p>The beginning of coroutines was when generators were added to the python. Generators are lazily evaluated list. In normal function you would use return to get the value from called function but with generators you use yield keyword. More specifically with return, the function is done with the work but with yield, it emits a value and pause its execution. This continues until caller calls the next on generator. At which point the generator resumes its execution after the yield statement.<br>So basically lifecycle in generator is something like: emitting a value -&gt; suspends execution -&gt; returns flow back to the calling code.</p><pre class="language-python"><code class="language-python"><br><span class="token keyword">def</span> <span class="token function">square</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">yield</span> i <span class="token operator">*</span> i</code></pre><p>Up until now, yield was used as a keyword to emit the value. It has no capability to take input. After sometime the changes were introduced:</p><ul><li>yield, which was previously a statement, was redefined to be an expression.</li><li>Added a send() method to inject inputs during execution.</li><li>Added a throw() method to inject exceptions.</li><li>Added a close() method to allow the caller to terminate a generator early.</li></ul><p>Let's understand each in detail:</p><ol><li>Send:</li></ol><pre class="language-python"><code class="language-python"><br><span class="token keyword">def</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    value <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token string">"ready"</span><br>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Received:"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><br><br>g <span class="token operator">=</span> gen<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># intialize generator</span><br><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># "ready"</span><br>g<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token comment"># Resume and send value</span></code></pre><ol start="2"><li>throw:</li></ol><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">try</span><span class="token punctuation">:</span><br>        <span class="token keyword">yield</span> <span class="token string">"running"</span><br>    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Caught ValueError inside generator"</span><span class="token punctuation">)</span><br><br>g <span class="token operator">=</span> gen<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token comment"># "running"</span><br><br>g<span class="token punctuation">.</span>throw<span class="token punctuation">(</span>ValueError<span class="token punctuation">)</span></code></pre><ol start="3"><li>close:</li></ol><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">try</span><span class="token punctuation">:</span><br>        <span class="token keyword">yield</span> <span class="token number">1</span><br>        <span class="token keyword">yield</span> <span class="token number">2</span><br>    <span class="token keyword">finally</span><span class="token punctuation">:</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Cleaning up..."</span><span class="token punctuation">)</span><br><br>g <span class="token operator">=</span> gen<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># 1</span><br>g<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Cleaning up, not yielding 2 as we closed the generator</span></code></pre><p>Now try to understand the below code:</p><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> itertools<br><br><span class="token keyword">def</span> <span class="token function">averager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br><br>    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># emit none and expect an input from calling code via send</span><br>    counter <span class="token operator">=</span> itertools<span class="token punctuation">.</span>count<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># initializing the counter</span><br>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span><br>        <span class="token builtin">sum</span> <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token builtin">sum</span> <span class="token operator">/</span> <span class="token builtin">next</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># emits the average and expects the next value via send.</span><br><br>avg <span class="token operator">=</span> averager<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token builtin">next</span><span class="token punctuation">(</span>avg<span class="token punctuation">)</span><br>avg<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># 10</span><br>avg<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment"># 15</span><br>avg<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment"># 20</span></code></pre><p><strong>Python 3.3: &quot;yield from&quot;</strong><br>The generator can yield only to its immediate caller and if you want to split generators up for a reasons of code re-use and modularity, the calling generator would have to manually iterate the sub-generator and re-yield all its results.</p><pre class="language-python"><code class="language-python"><span class="token comment"># Implementation in pre-3.3 Python</span><br><span class="token keyword">def</span> <span class="token function">chain</span><span class="token punctuation">(</span><span class="token operator">*</span>generators<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">for</span> generator <span class="token keyword">in</span> generators<span class="token punctuation">:</span><br>        <span class="token keyword">for</span> item <span class="token keyword">in</span> generator<span class="token punctuation">:</span><br>            <span class="token keyword">yield</span> item<br><br><span class="token comment"># Implementation in post-3.3 Python</span><br><span class="token keyword">def</span> <span class="token function">chain</span><span class="token punctuation">(</span><span class="token operator">*</span>generators<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">for</span> generator <span class="token keyword">in</span> generators<span class="token punctuation">:</span><br>        <span class="token keyword">yield</span> <span class="token keyword">from</span> generator</code></pre><p>Let's take an example:</p><pre class="language-python"><code class="language-python"><br><span class="token keyword">def</span> <span class="token function">parse_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    digits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><br>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span><br>        ch <span class="token operator">=</span> <span class="token keyword">yield</span><br>        <span class="token keyword">if</span> ch<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>            digits<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ch<span class="token punctuation">)</span><br>        <span class="token keyword">else</span><span class="token punctuation">:</span><br>            <span class="token keyword">break</span><br><br>    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>digits<span class="token punctuation">)</span><span class="token punctuation">)</span><br><br><br><span class="token keyword">def</span> <span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span><br>        result <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> parse_number<span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Parsed number: "</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><br><br><br>p <span class="token operator">=</span> parser<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token builtin">next</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br><span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"123x45y"</span><span class="token punctuation">:</span><br>    p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>c<span class="token punctuation">)</span><br><br></code></pre><p>Basically it means: &quot;Suspend me. The child is now the generator. Route EVERYTHING through it until it finishes.&quot;</p><p>It automatically:</p><ul><li>forwards every .send()</li><li>forwards every .throw()</li><li>propagates exceptions</li><li>captures child return value</li><li>resumes parent afterward</li><li>handles GeneratorExit</li><li>handles close()</li></ul><p>All in one line.</p><h4 id="the-state-of-python-coroutines%3A-introducing-asyncio" tabindex="-1"><a class="header-anchor" href="#the-state-of-python-coroutines%3A-introducing-asyncio">#</a> The state of Python coroutines: Introducing asyncio</h4><p>AsyncIO has a handy event loop for scheduling coroutines. Asyncio gives you a ready-made event loop that can run code in two styles:</p><ul><li>Old-school callbacks (functions triggered when something happens)</li><li>Modern coroutines (async/await) that look blocking but actually aren't</li></ul><p>Either way, the same event loop schedules everything. And even if you don't care about networking or files, the coroutine scheduler itself is valuable, it lets you coordinate many tasks without writing your own scheduler.</p><ul><li>asyncio isnt just about async IO.</li><li>It provides a general-purpose cooperative task scheduler.</li></ul><p><strong>Callback style:</strong></p><pre class="language-python"><code class="language-python">loop<span class="token punctuation">.</span>call_later<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></code></pre><p><strong>Coroutine style:</strong></p><pre class="language-python"><code class="language-python"><span class="token keyword">await</span> something<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>The loop pauses and resumes tasks automatically.</p><p>Let me show you an example of cooperative scheduling using only one OS thread. The below example shows you can run multiple long-running background jobs concurrently with one thread.</p><pre class="language-python"><code class="language-python"><br><span class="token keyword">import</span> asyncio<br><span class="token keyword">import</span> datetime<br><span class="token keyword">import</span> errno<br><span class="token keyword">import</span> os<br><span class="token keyword">import</span> sys<br><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path<br><br><span class="token keyword">def</span> <span class="token function">rotate_file</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> keep_versions<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token triple-quoted-string string">"""<br>    Create versions of the file and promote 1 to 2, 2 to 3, 3 to 4.<br>    """</span><br>    path <span class="token operator">=</span> Path<span class="token punctuation">(</span>path<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> <span class="token keyword">not</span> path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">return</span><br><br>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>keep_versions<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>        old <span class="token operator">=</span> path<span class="token punctuation">.</span>with_suffix<span class="token punctuation">(</span>path<span class="token punctuation">.</span>suffix <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f".</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        new <span class="token operator">=</span> path<span class="token punctuation">.</span>with_suffix<span class="token punctuation">(</span>path<span class="token punctuation">.</span>suffix <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f".</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">if</span> old<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>            old<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>new<span class="token punctuation">)</span><br>        <br>    path<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>path<span class="token punctuation">.</span>with_suffix<span class="token punctuation">(</span>path<span class="token punctuation">.</span>suffix <span class="token operator">+</span> <span class="token string">".1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br><span class="token decorator annotation punctuation">@asyncio<span class="token punctuation">.</span>coroutine</span><br><span class="token keyword">def</span> <span class="token function">rotate_by_interval</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> keep_versions<span class="token punctuation">,</span> rotate_secs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token triple-quoted-string string">"""<br>    Rotate file every N seconds.<br>    """</span><br>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span><br>        <span class="token keyword">yield</span> <span class="token keyword">from</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>rotate_secs<span class="token punctuation">)</span><br>        rotate_file<span class="token punctuation">(</span>path<span class="token punctuation">,</span> keep_versions<span class="token punctuation">)</span><br><br><span class="token decorator annotation punctuation">@async<span class="token punctuation">.</span>coroutine</span><br><span class="token keyword">def</span> <span class="token function">rotate_daily</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> keep_versions<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token triple-quoted-string string">"""<br>    Rotate file every midnight.<br>    """</span><br>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span><br>        now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><br>        last_midnight <span class="token operator">=</span> now<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>hour<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> minute<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> second<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><br>        next_midnight <span class="token operator">=</span> last_midnight <span class="token operator">+</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><br>        <span class="token keyword">yield</span> <span class="token keyword">from</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token punctuation">(</span>next_midnight <span class="token operator">-</span> now<span class="token punctuation">)</span><span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        rotate_file<span class="token punctuation">(</span>path<span class="token punctuation">,</span> keep_versions<span class="token punctuation">)</span><br><br><span class="token decorator annotation punctuation">@async<span class="token punctuation">.</span>coroutine</span><br><span class="token keyword">def</span> <span class="token function">rotate_by_size</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> keep_versions<span class="token punctuation">,</span> max_size<span class="token punctuation">,</span> check_interval_secs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token triple-quoted-string string">"""<br>    Rotate file when it exceeds N bytes checking every M seconds.<br>    """</span><br>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span><br>        <span class="token keyword">yield</span> <span class="token keyword">from</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>check_interval_secs<span class="token punctuation">)</span><br>        <span class="token keyword">try</span><span class="token punctuation">:</span><br>            filesize <span class="token operator">=</span> Path<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>stat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>st_size<br>            <span class="token keyword">if</span> filesize <span class="token operator">></span> max_size<span class="token punctuation">:</span><br>                rotate_file<span class="token punctuation">(</span>path<span class="token punctuation">,</span> keep_versions<span class="token punctuation">)</span><br>        <span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span><br>            <span class="token keyword">pass</span><br><br><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    rotate1 <span class="token operator">=</span> loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>rotate_by_interval<span class="token punctuation">(</span><span class="token string">"/tmp/file1"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    rotate2 <span class="token operator">=</span> loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>rotate_by_interval<span class="token punctuation">(</span><span class="token string">"/tmp/file2"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    rotate3 <span class="token operator">=</span> loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>rotate_by_size<span class="token punctuation">(</span><span class="token string">"/tmp/file3"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    rotate4 <span class="token operator">=</span> loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>rotate_daily<span class="token punctuation">(</span><span class="token string">"/tmp/file4"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    loop<span class="token punctuation">.</span>run_forever<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span><br>    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>All of this happens using:</p><ul><li>one OS thread</li><li>one asyncio event loop</li><li>cooperative scheduling via yield from asyncio.sleep(...)</li></ul><p>You can see that main() just creates a bunch of tasks and plugs them into an event loop, then asyncio takes care of the scheduling. This approach is quite modular and manages to produce single-threaded code where different asynchronous operations interoperate with little or no awareness of each other.</p><p>I will be writing part 2 soon, which will go in depth in other asyncio primitives like callbacks based and await based. You can find this whole code <a href="https://github.com/ayush-garg341/python/tree/master/coroutines">here</a></p><p>The above code is not mine and I just tweaked it a little. You can find more about original author and post <a href="https://www.andy-pearce.com/blog/posts/2016/Jun/the-state-of-python-coroutines-introducing-asyncio/">here</a>.</p><p class="tag-list"><a class="tag" href="/portfolio/tags/python/" rel="tag">python</a> <a class="tag" href="/portfolio/tags/yield/" rel="tag">yield</a> <a class="tag" href="/portfolio/tags/generators/" rel="tag">generators</a> <a class="tag" href="/portfolio/tags/coroutines/" rel="tag">coroutines</a> <a class="tag" href="/portfolio/tags/asyncio/" rel="tag">asyncio</a></p></article><nav><a href="/portfolio/blog/">‚Üê View All Articles</a></nav></div></main><footer class="site-footer"><medium>Connect with me on <a href="https://x.com/bbetterengineer" target="_blank">X</a>, <a href="https://github.com/ayush-garg341" target="_blank">GitHub</a> or <a href="https://www.linkedin.com/in/ayush-garg-5bb04114b/" target="_blank">Linkedin</a>.</medium></footer></body></html>